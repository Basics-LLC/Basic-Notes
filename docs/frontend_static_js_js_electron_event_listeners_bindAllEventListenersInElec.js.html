<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: frontend/static/js/js_electron/event_listeners/bindAllEventListenersInElec.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: frontend/static/js/js_electron/event_listeners/bindAllEventListenersInElec.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const {contextBridge, ipcRenderer} = require('electron');
const electron = require('electron');
const {dialog} = require('electron').remote;
const path = require('path');
const fs = require('fs');

/**
 * Bind all event listeners in Electron app
 */
function bindAllEventListenersInElec() {
  // Element Declarations
  const newFileBtn = document.getElementById('new-file');
  const uploadFileBtn = document.getElementById('upload-file');
  const saveFileBtn = document.getElementById('save-file');
  const textContent = document.getElementById('textarea');
  const noteTitle = document.getElementById('title');

  const activeFile ='';

  // Button Actions
  saveFileBtn.addEventListener('click', () =>{
    let fname = '';
    const content=textContent.value;
    if (isFileActive()) {
      fname = getActiveFile();
    } else {
      fname = openSaveDialog('');
    }
    createFile(fname);
    return false;
  });

  electron.ipcRenderer.on('open-file', (event, arg) => {
    const filename = openSelectFileDialog();
    openFile(filename);
  });

  electron.ipcRenderer.on('new-file', (event, arg) => {
    cancelFileEdit();
  });

  uploadFileBtn.addEventListener('click', () =>{
    const filename = openSelectFileDialog();
    openFile(filename);
  });

  newFileBtn.addEventListener('click', () =>{
    cancelFileEdit();
    return false;
  });
}

// Compound Functions

function saveFile(filename) {
  setActiveFile(filename);
  setCurrentFileName();
  // showAlertBar(); //Notify about saved file
}

function openFile(filename) {
  setActiveFile(filename);
  setCurrentFileName();
  writeFileToTextArea();
}

function cancelFileEdit() {
  setActiveFile(undefined);
  noteTitle.value = '';
  textContent.value = '';
}

// //Utililty Functions

function writeFileToTextArea() {
  const currentFile = getActiveFile();
  if (validateFile(currentFile)) {
    const mdData = fs.readFileSync(getActiveFile()).toString();
    textContent.value = mdData;
  }
}


function isFileActive() {
  if (activeFile=== undefined || activeFile ==='') {
    return false;
  }
  return true;
}

function getActiveFile() {
  return activeFile;
}

function createFile(fname) {
  const content=textContent.value;
  writeToFile(content, fname).then(function() {
    saveFile(fname);
  });
}

function validateFile(filename) {
  const ext = path.extname(filename);
  if (ext === '.md') {
    return true;
  }
  return false;
}

function setCurrentFileName() {
  const filename = getActiveFile();
  noteTitle.value = getFileName(filename);
}

function openSaveDialog(df) {
  const filename= dialog.showSaveDialog(
      {defaultPath: df, properties: ['selectFile']});
  setActiveFile(filename);
  return filename;
}


function openSelectFileDialog() {
  const files = dialog.showOpenDialog(
      {properties: ['openFile']});
  const filename = files[0];
  return filename;
}

function getFileName(fullPath) {
  if (fullPath !== undefined) {
    return fullPath.toString().replace(/^.*[\\\/]/, '');
  }
}

function addRecentFile(fileName, filePath) {
  // ***STUB***
  // TODO: Implement database to fetch recent files
}

function setActiveFile(filename) {
  activeFile = filename;
  const name = getFileName(filename);
  if (filename !== undefined) {
    addRecentFile(name, filename);
  }
}

async function writeToFile(text, filename) {
  console.log(filename);
  if (filename!== undefined &amp;&amp; validateFile(filename)) {
    fs.writeFile(filename, text, function(err) {
      if (err) {
        return console.log(err);
      }
      return true;
    });
  }
}

module.exports = bindAllEventListenersInElec;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="module.html#.exports">exports</a></li></ul><h3>Global</h3><ul><li><a href="global.html#bindAllEventListeners">bindAllEventListeners</a></li><li><a href="global.html#bindAllEventListenersInElec">bindAllEventListenersInElec</a></li><li><a href="global.html#bindEventListener">bindEventListener</a></li><li><a href="global.html#bindEventListenerAsync">bindEventListenerAsync</a></li><li><a href="global.html#cleanUp">cleanUp</a></li><li><a href="global.html#constructFile">constructFile</a></li><li><a href="global.html#createWindow">createWindow</a></li><li><a href="global.html#getHtml">getHtml</a></li><li><a href="global.html#isElectron">isElectron</a></li><li><a href="global.html#onFileReadListener">onFileReadListener</a></li><li><a href="global.html#openFileDialog">openFileDialog</a></li><li><a href="global.html#readFile">readFile</a></li><li><a href="global.html#readFileContent">readFileContent</a></li><li><a href="global.html#readFileName">readFileName</a></li><li><a href="global.html#saveFile">saveFile</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.0</a> on Sun Nov 13 2022 17:15:19 GMT-0800 (Pacific Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
